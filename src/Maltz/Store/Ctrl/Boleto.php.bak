<?php

namespace Maltz\Store\Ctrl;

/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */

/**
 * Description of boleto
 *
 * @author koblitz
 */
class Boleto extends Controller {

    public static function gerar() {

        if (!isset($_SESSION['cliente'])) {
            redirect_to('index.php/entrar');
        }

        $pedido_id = params('pedido_id');
        $pedido = new Pedido(option('modelo'));
        $pedido->mostrar($pedido_id);
        $dadospedido = $pedido->getDados();

        if ($dadospedido['activity'] == 0) {
            $_SESSION['mensagem'] = 'Pedido desativado';
            return redirect_to('index.php');
        }

        $cliente = new Cliente(option('modelo'));
        $cliente->mostrar($dadospedido['cliente_id']);
        $dadoscliente = $cliente->getDados();


        // validacao -> veja se ha frete
        $valor = intval($dadospedido['preco']) + intval($dadospedido['frete']);

        $num_length = strlen((string) $pedido_id);

        $zerofill = 11 - $num_length;

        $numero = str_pad($num_length, $zerofill, '0', STR_PAD_LEFT);
        // validar tamanho do numero

        set('dadosboleto', boleto_supplymed($valor, $dadoscliente, $numero));

        return html('boleto/layout_bradesco.tpl.php');
    }

}
